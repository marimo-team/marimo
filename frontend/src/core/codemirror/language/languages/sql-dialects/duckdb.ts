/* Copyright 2024 Marimo. All rights reserved. */
// Credit to https://github.com/sekuel/codemirror-sql-duckdb/blob/main/DuckDBDialect.js for the dialect spec

import { SQLDialect, type SQLDialectSpec } from "@codemirror/lang-sql";

const otherFunctions =
  "percentile_cont row_number rank dense_rank rank_dense percent_rank cume_dist ntile lag lead first_value last_value nth_value first last";

const DuckDBDialectSpec: SQLDialectSpec = {
  operatorChars: "*+-%<>!=&|^",
  charSetCasts: true,
  doubleQuotedStrings: false,
  unquotedBitLiterals: true,
  hashComments: false,
  spaceAfterDashes: false,
  specialVar: "@?",
  identifierQuotes: "`",
  keywords: `${otherFunctions} !__postfix !~~ !~~* % & * ** + - / // << >> @ ^ ^@ abort abs absolute access access_mode acos action add admin after age aggregate alias all all_profiling_output allow_unsigned_extensions also alter always analyse analyze and anti any any_value apply approx_count_distinct approx_quantile arbitrary arg_max arg_min argmax argmin array array_agg array_aggr array_aggregate array_append array_apply array_cat array_concat array_contains array_distinct array_extract array_filter array_has array_indexof array_length array_pop_back array_pop_front array_position array_prepend array_push_back array_push_front array_reverse_sort array_slice array_sort array_to_string array_transform array_unique arrow_large_buffer_size arrow_scan arrow_scan_dumb as asc ascii asin asof assertion assignment asymmetric at atan atan2 attach attribute authorization avg backward bar base64 before begin between bigint bin binary binary_as_string bit bit_and bit_count bit_length bit_or bit_xor bitstring_agg blob bool bool_and bool_or boolean both bpchar by bytea cache call called cardinality cascade cascaded case cast catalog cbrt ceil ceiling century chain char character characteristics check checkpoint checkpoint_threshold chr class close cluster coalesce col_description collate collation collations column columns combine comment comments commit committed compression concat_ws concurrently configuration conflict connection constant_or_null constraint constraints content continue conversion copy corr cos cost count count_if count_star covar_pop covar_samp create create_fts_index cross csv cube current current_catalog current_database current_date current_query current_role current_schema current_schemas current_setting current_user currval custom_extension_repository cycle damerau_levenshtein data database database_list database_size date date_add date_diff date_part date_sub date_trunc datediff datepart datesub datetime datetrunc day dayname dayofmonth dayofweek dayofyear days deallocate debug_asof_iejoin debug_checkpoint_abort debug_force_external debug_force_no_cross_product dec decade declare decode default default_collation default_null_order default_order defaults deferrable definer degrees delimiters depends desc describe detach dictionary disable disable_checkpoint_on_shutdown disable_object_cache disable_optimizer disable_print_progress_bar disable_profile disable_profiling disable_progress_bar disable_verification disable_verify_external disable_verify_parallelism disable_verify_serializer disabled_optimizers discard distinct divide do document domain double drop drop_fts_index duckdb_columns duckdb_constraints duckdb_databases duckdb_dependencies duckdb_extensions duckdb_functions duckdb_indexes duckdb_keywords duckdb_schemas duckdb_sequences duckdb_settings duckdb_tables duckdb_temporary_files duckdb_views each editdist3 element_at else enable enable_checkpoint_on_shutdown enable_external_access enable_fsst_vectors enable_object_cache enable_optimizer enable_print_progress_bar enable_profile enable_progress_bar enable_progress_bar_print enable_verification encode encoding encrypted end entropy enum enum_code enum_first enum_last enum_range enum_range_boundary epoch epoch_ms era error escape even event except exclude excluding exclusive execute exists exp experimental_parallel_csv explain explain_output export export_state extension extension_directory external external_threads extract false family fdiv fetch file_search_path filter finalize flatten float float4 float8 floor fmod following for force force_bitpacking_mode force_checkpoint force_compression force_index_join foreign format formatReadableDecimalSize format_bytes format_pg_type format_type forward freeze from from_base64 from_binary from_hex full function functions gamma gcd gen_random_uuid generate_series generate_subscripts generated get_bit get_current_time get_current_timestamp glob global grant granted greatest greatest_common_divisor group grouping grouping_id guid hamming handler has_any_column_privilege has_column_privilege has_database_privilege has_foreign_data_wrapper_privilege has_function_privilege has_language_privilege has_schema_privilege has_sequence_privilege has_server_privilege has_table_privilege hash having header hex histogram hold home_directory hour hugeint identity if ignore ilike ilike_escape immediate immediate_transaction_mode implicit import in include including increment index index_scan indexes inet_client_addr inet_client_port inet_server_addr inherits initially inline inner inout input insensitive insert install instr int int1 int128 int16 int2 int32 int4 int64 int8 integer integer_division integral intersect interval into invoker is isinf isnull isodow isolation isoyear jaccard jaro_similarity jaro_winkler_similarity join json kahan_sum key kurtosis label language large last last_day lateral lcase lcm leading leakproof least least_common_multiple left len length_grapheme level levenshtein lgamma like like_escape limit list list_any_value list_append list_approx_count_distinct list_avg list_bit_or list_bit_xor list_bool_and list_bool_or list_concat list_contains list_count list_distinct list_entropy list_extract list_filter list_has list_histogram list_indexof list_kurtosis list_last list_mad list_max list_median list_min list_mode list_pack list_position list_prepend list_product list_reverse_sort list_skewness list_slice list_sort list_stddev_pop list_stddev_samp list_string_agg list_sum list_transform list_unique list_value list_var_pop list_var_samp listen ln load local location lock lock_configuration locked log log2 log_query_path logged logical long lower lpad macro mad make_date make_time make_timestamp map map_concat map_entries map_from_entries map_keys mapping materialized max max_by max_expression_depth max_memory maxvalue md5 md5_number md5_number_lower md5_number_upper mean median memory_limit microseconds millennium millisecond milliseconds min_by minute minutes minvalue mismatches mod mode month monthname months move name names natural new nextafter no none not not_ilike_escape not_like_escape notify notnull now nowait null null_order nullif numeric object octet_length of off offset oid oids old only operator option options or order ordinality outer over overlaps overlay overriding owned owner parallel parquet_metadata parquet_scan parquet_schema parser partial partition password percent perfect_ht_threshold pg_conversion_is_visible pg_function_is_visible pg_get_constraintdef pg_get_expr pg_has_role pg_is_other_temp_schema pg_my_temp_schema pg_opclass_is_visible pg_operator_is_visible pg_postmaster_start_time pg_size_pretty pg_table_is_visible pg_ts_config_is_visible pg_ts_dict_is_visible pg_ts_parser_is_visible pg_ts_template_is_visible pg_type_is_visible pg_typeof pivot pivot_longer pivot_wider placing plans policy position pow power pragma_collations pragma_database_size pragma_detailed_profiling_output pragma_last_profiling_output pragma_storage_info pragma_table_info pragma_version preceding precision prepare preserve preserve_insertion_order primary printf prior privileges procedure product profiler_history_size profiling_mode profiling_output program publication qualify quantile_cont quote radians random range read read_csv_auto read_parquet real reassign recheck recursive ref references referencing refresh regexp_extract_all regexp_full_match regexp_replace regexp_split_to_array regr_avgx regr_count regr_intercept regr_r2 regr_slope regr_sxx reindex relative release rename repeat repeat_row repeatable replica reservoir_quantile reset restart restrict returning returns reverse revoke rollback rollup round round_even roundbankers row rows rpad rtrim rule s3_endpoint s3_region s3_secret_access_key s3_session_token sample savepoint schema scroll search second seconds security semi seq_scan sequence sequences serializable server session session_user set_bit setof sets shobj_description show show_databases show_tables show_tables_expanded sign signbit signed sin skip smallint snapshot split split_part stable standalone start starts_with statement statistics stddev stddev_pop stdin stdout storage storage_info str_split strict string string_agg string_split string_split_regex string_to_array strip strip_accents strpos strptime struct struct_extract struct_insert struct_pack subscription substr subtract suffix sum sum_no_overflow sumkahan summarize summary symmetric sysid system table table_info tables tablesample tablespace tan temp template temporary test_all_types test_vector_types text then time_bucket timestamp timestamp_ms timetz timezone timezone_hour tinyint to to_base64 to_days to_hex to_hours to_microseconds to_milliseconds to_minutes to_months to_seconds to_timestamp to_years today trailing transaction transaction_timestamp transform treat trim true trunc trusted try_cast try_strptime txid_current type typeof types ubigint ucase uint16 uint32 uint64 uint8 uinteger unbounded uncommitted unencrypted unhex unicode union_extract union_tag union_value unknown unlisten unlogged unnest unpivot update upper use user using usmallint utinyint uuid vacuum validate validator value values var_pop var_samp varchar variadic varying verbose verify_external verify_parallelism views virtual volatile wal_autocheckpoint week weekday weekofyear when where whitespace window within without work worker_threads write xml xmlconcat xmlelement xmlexists xmlforest xmlnamespaces xmlparse xmlpi xmlroot year years yearweek yes | || ~ ~~ ~~* bit_position contains cot cursor debug_window_mode decimal deferred duckdb_types enable_http_metadata_cache first fsum group_concat has_tablespace_privilege hours immutable in_search_path inet_server_port instead isfinite isnan left_grapheme length list_aggr list_aggregate list_apply list_bit_and list_cat list_element list_first list_sem log10 ltrim map_extract match microsecond min multiply national nchar next nextval nfc_normalize nothing nulls nvarchar obj_description on ord out passing pg_collation_is_visible pg_conf_load_time pi pivot_limit positional pragma preserve_identifier_case procedural progress_bar_time quantile_disc read_csv regexp_matches regr_avgy regr_sxy regr_syy s3_access_key_id schemas select sem setseed short similar some sql stats stored str_split_regex strftime strlen substring substring_grapheme temp_directory timestamp_ns to_binary translate trigger truncate unbin union unique until username valid variance verify_serializer view with wrapper xmlattributes xmltable xor zone ~~~ delete delimiter enable_profiling favg import_database inherit map_values pg_get_viewdef pg_opfamily_is_visible prefix prepared quantile regexp_extract right_grapheme role search_path share skewness sqrt threads timestamp_s timezone_minute version bitstring concat factorial quarter replace right stddev_samp stem timestamp_us method respect simple time varbinary xmlserialize profile_output set timestamptz ordered_aggregate_threshold`,
  types:
    "double float null guid bitstring bit union map boolean list bool struct uint8 int1 tinyint short timestamp_us int32 integral signed string int timestamptz int4 integer logical nvarchar uint64 uint32 ubigint timestamp int64 text oid row date int16 bigint float8 int128 smallint hugeint binary dec bpchar real varbinary uinteger uint16 interval varchar decimal timetz uuid char timestamp_ns timestamp_s time utinyint blob datetime int8 enum usmallint numeric float4 bytea int2 long timestamp_ms",
};

export const DuckDBDialect = SQLDialect.define(DuckDBDialectSpec);
